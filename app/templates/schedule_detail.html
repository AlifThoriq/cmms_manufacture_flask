{% extends "base_layout.html" %}

{% block content %}

<h2>Detail Jadwal Perawatan: {{ schedule.task_name }}</h2>

<div style="float: right; width: 300px;"> 

    <form action="{{ url_for('schedules.delete_schedule', schedule_id=schedule['_id']) }}" 
      method="POST" 
      onsubmit="return confirmDelete();" 
      style="margin: 0;"
    class="form-no-shadow">
      
    <button type="submit"
        style="font-weight: bold; color: #f44336; padding: 8px 15px; border: 1px solid #f44336;
               border-radius: 5px; background: white; text-decoration: none; display: block;
               width: 100%; text-align: center; box-sizing: border-box; margin-bottom: 10px;
               cursor: pointer;">
        Hapus Jadwal Ini
    </button>
</form>

    <div style="border: 1px solid #ccc; padding: 10px; border-radius: 5px;">
        <h4>Informasi Aset</h4>
        <p><strong>Tipe Aset:</strong> {{ schedule.asset_type }}</p>
        <p><strong>Frekuensi:</strong> {{ schedule.frequency_days }} hari</p>
        <p><strong>Jatuh Tempo Berikutnya:</strong> {{ schedule.next_due_date.strftime('%Y-%m-%d') }}</p>
        <p><strong>Status:</strong> 
            <span style="font-weight: bold; color: {{ schedule.status_color }};">
                {{ schedule.status_text }}
            </span>
        </p>
    </div>
</div>


<h3>Informasi Jadwal</h3>

<a href="{{ url_for('schedules.schedule_maintenance', schedule_id=schedule['_id']) }}"
   style="font-weight: bold; color: #ff9800; padding: 4px 15px; border: 1px solid #ff9800;
          border-radius: 5px; text-decoration: none; display: inline-block; margin-bottom: 20px;">
   Lakukan Perawatan Rutin
</a>


<p><strong>Nama Tugas:</strong> {{ schedule.task_name }}</p>
<p><strong>Tipe Aset:</strong> {{ schedule.asset_type }}</p>
<p><strong>Frekuensi (hari):</strong> {{ schedule.frequency_days }}</p>
<p><strong>Dibuat / Diperbarui:</strong> {{ schedule.last_updated.strftime('%Y-%m-%d %H:%M') if schedule.last_updated else 'N/A' }}</p>
<p><strong>Terakhir Dikerjakan:</strong> {{ schedule.last_completed.strftime('%Y-%m-%d %H:%M') if schedule.last_completed else 'Belum pernah' }}</p>


<hr style="clear: both; margin-top: 20px;">



<br>
<a href="{{ url_for('schedules.list_schedules') }}">&larr; Kembali ke Daftar Jadwal</a>

<!-- Modal konfirmasi hapus -->
<div id="confirmModal" style="
    display: none;
    position: fixed;
    z-index: 999;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.5);
    justify-content: center; align-items: center;
">
    <div style="
        background: #fff;
        padding: 20px 25px;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        width: 350px;
        text-align: center;
    ">
        <h4 style="margin-bottom: 10px; color: #333;">Konfirmasi Hapus</h4>
        <p style="color: #555;">Apakah Anda yakin ingin menghapus jadwal ini?<br>
           Tindakan ini tidak dapat dibatalkan.</p>
        <div style="margin-top: 20px; display: flex; justify-content: space-around;">
            <button id="confirmYes" style="
                background-color: #f44336;
                color: white;
                border: none;
                padding: 8px 20px;
                border-radius: 5px;
                cursor: pointer;
            ">Ya, Hapus</button>

            <button id="confirmNo" style="
                background-color: #ccc;
                color: black;
                border: none;
                padding: 8px 20px;
                border-radius: 5px;
                cursor: pointer;
            ">Batal</button>
        </div>
    </div>
</div>

<script>
let formToSubmit = null;

function confirmDelete() {
    // Simpan referensi form yang diklik
    formToSubmit = event.target;
    document.getElementById('confirmModal').style.display = 'flex';
    return false; // hentikan submit sampai user konfirmasi
}

document.getElementById('confirmYes').onclick = function() {
    if (formToSubmit) formToSubmit.submit();
};

document.getElementById('confirmNo').onclick = function() {
    document.getElementById('confirmModal').style.display = 'none';
    formToSubmit = null;
};
</script>

{% endblock %}